{"version":3,"file":"loader.esm.js","sources":["../lib/index.js"],"sourcesContent":["// -----------------------------------------------------------------------------\n// Init\n\nconst initializeGlobalNamespace = () => {\n  let namespace;\n  if (typeof window === 'object') {\n    namespace = window.filestackInternals;\n    if (!namespace) {\n      namespace = {};\n      window.filestackInternals = namespace;\n    }\n    if (!namespace.loader) {\n      namespace.loader = {\n        modules: {},\n      };\n    }\n  }\n  return namespace;\n};\n\nconst filestackInternals = initializeGlobalNamespace();\n\n// -----------------------------------------------------------------------------\n// Modules loading\n\n// All modules share global \"register\", so different instances of loader can\n// communicate which modules were already loaded and which not.\nconst modules = filestackInternals && filestackInternals.loader.modules;\n\nexport const loadModule = (url, moduleId) => {\n  let moduleDefinition = modules[url];\n  if (!moduleDefinition) {\n    modules[url] = {};\n    moduleDefinition = modules[url];\n  }\n\n  if (moduleDefinition.instance) {\n    return Promise.resolve(moduleDefinition.instance);\n  }\n\n  if (moduleDefinition.promise) {\n    return moduleDefinition.promise;\n  }\n\n  const promise = new Promise((resolve, reject) => {\n    const embedScript = () => {\n      moduleDefinition.resolvePromise = resolve;\n      const script = document.createElement('script');\n      script.src = url;\n      script.onerror = reject;\n      if (moduleId) script.id = moduleId;\n      document.body.appendChild(script);\n    };\n\n    const checkIfDomReady = () => {\n      if (document.readyState === 'complete') {\n        embedScript();\n      } else {\n        setTimeout(checkIfDomReady, 50);\n      }\n    };\n\n    checkIfDomReady();\n  });\n\n  moduleDefinition.promise = promise;\n\n  return promise;\n};\n\nexport const registerReadyModule = (instance, moduleId) => {\n  let thisScript;\n  if (moduleId && document.getElementById(moduleId)) {\n    thisScript = document.getElementById(moduleId);\n  } else {\n    const scriptTags = document.getElementsByTagName('script');\n    thisScript = scriptTags[scriptTags.length - 1];\n  }\n  const url = thisScript.getAttribute('src');\n  const moduleDefinition = modules[url];\n  if (moduleDefinition && moduleDefinition.resolvePromise) {\n    moduleDefinition.instance = instance;\n    moduleDefinition.resolvePromise(instance);\n    delete moduleDefinition.promise;\n    delete moduleDefinition.resolvePromise;\n  }\n};\n\n// -----------------------------------------------------------------------------\n// CSS loading\n\nexport const loadCss = (url) => {\n  const alreadyAddedThisTag = document.querySelector(`link[href=\"${url}\"]`);\n  if (alreadyAddedThisTag !== null) {\n    return Promise.resolve();\n  }\n\n  return new Promise((resolve) => {\n    const head = document.getElementsByTagName('head')[0];\n    const link = document.createElement('link');\n\n    const loaded = () => {\n      resolve();\n      link.removeEventListener('load', loaded);\n    };\n\n    link.rel = 'stylesheet';\n    link.href = url;\n    link.addEventListener('load', loaded);\n    head.appendChild(link);\n  });\n};\n\nexport const knownModuleIds = {\n  picker: '__filestack-picker-module',\n};\n"],"names":["initializeGlobalNamespace","namespace","window","filestackInternals","loader","modules","loadModule","url","moduleId","moduleDefinition","instance","Promise","resolve","promise","reject","embedScript","resolvePromise","script","document","createElement","src","onerror","id","body","appendChild","checkIfDomReady","readyState","registerReadyModule","thisScript","getElementById","scriptTags","getElementsByTagName","length","getAttribute","loadCss","alreadyAddedThisTag","querySelector","head","link","loaded","removeEventListener","rel","href","addEventListener","knownModuleIds"],"mappings":"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"}